# our build should run within a Ruby box
box: ruby
build:
  steps:
    # Run a smart version of bundle install
    # which improves build execution time of
    # future builds
    
    # Install javascript environment
    # A step that executes `npm install` command
    - npm-install
    # A step that executes `npm test` command
    - npm-test

    
    - script:
        name: bundle - nokogiri use sys lib
        code: bundle config build.nokogiri --use-system-libraries
    
    - bundle-install

    # A custom script step
    # that actually builds the jekyll site
    - script:
        name: generate site
        code: bundle exec jekyll build --trace

deploy:
  steps:
    # Deploy to s3
    - s3sync:
      key_id: $AWS_S3_ID
      key_secret: $AWS_S3_SECRET
      bucket_url: $AWS_S3_BUCKET_URL
      source_dir: _site/
